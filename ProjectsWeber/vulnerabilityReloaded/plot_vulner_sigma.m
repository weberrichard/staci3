close all; 
clear;

addpath('../../Plot');

% cases= ["villasor","ferto","sanchegy","buk","lovo","nagycenk","vashegy","varis","becsidomb","tomalom",...
%     "szakov","kohegy","harka","pozsonyiut","sopronkovesd","dudlesz","ivan","agyagosszergeny","kofejto","simasag",...
%     "acsad","csaford","nagylozs","balf","csapod","und","rojtokmuzsaj","brennberg","pusztacsalad","kutyahegy",...
%     "nyarliget","meszlen","fertoujlak","gorbehalom","tozeggyarmajor","ebergoc","csillahegy","jerevan","gloriette",...
%     "ohermes","ujhermes"];

% cases= ["villasor_mat","ferto_mat","sanchegy_mat","buk_mat","lovo_mat","nagycenk_mat","vashegy_mat","varis_mat","becsidomb_mat","tomalom_mat",...
%     "szakov_mat","kohegy_mat","harka_mat","pozsonyiut_mat","sopronkovesd_mat","dudlesz_mat","ivan_mat","agyagosszergeny_mat","kofejto_mat","simasag_mat",...
%     "acsad_mat","csaford_mat","nagylozs_mat","balf_mat","csapod_mat","und_mat","rojtokmuzsaj_mat","brennberg_mat","pusztacsalad_mat","kutyahegy_mat",...
%     "nyarliget_mat","meszlen_mat","fertoujlak_mat","gorbehalom_mat","tozeggyarmajor_mat","ebergoc_mat","csillahegy_mat","jerevan_mat","gloriette_mat",...
%     "ohermes_mat","ujhermes_mat"];

% cases= ["villasor_mat","villasor","sanchegy_mat","sanchegy","vashegy_mat","vashegy","varis_mat","varis",...
%     "becsidomb_mat","becsidomb","tomalom_mat","tomalom",...
%     "dudlesz_mat","dudlesz","balf_mat","balf","brennberg_mat","brennberg"];

% cases = ["ky1","ky2","ky3","ky4","ky5","ky6","ky7","ky8","ky9","ky10","ky11","ky12","ky13","ky14"];

% cases = ["villasor_sigma_opt","ferto_sigma_opt","sanchegy_sigma_opt","buk_sigma_opt","lovo_sigma_opt",...
%     "nagycenk_sigma_opt","vashegy_sigma_opt","varis_sigma_opt","becsidomb_sigma_opt","tomalom_sigma_opt",...
%     "szakov_sigma_opt","kohegy_sigma_opt","harka_sigma_opt","pozsonyiut_sigma_opt","sopronkovesd_sigma_opt",...
%     "dudlesz_sigma_opt","ivan_sigma_opt","agyagosszergeny_sigma_opt","kofejto_sigma_opt","simasag_sigma_opt",...
%     "acsad_sigma_opt","csaford_sigma_opt","nagylozs_sigma_opt","balf_sigma_opt","csapod_sigma_opt","und_sigma_opt",...
%     "rojtokmuzsaj_sigma_opt","brennberg_sigma_opt","pusztacsalad_sigma_opt","kutyahegy_sigma_opt",...
%     "nyarliget_sigma_opt","meszlen_sigma_opt","fertoujlak_sigma_opt","gorbehalom_sigma_opt",...
%     "tozeggyarmajor_sigma_opt","ebergoc_sigma_opt","csillahegy_sigma_opt","jerevan_sigma_opt",...
%     "gloriette_sigma_opt","ohermes_sigma_opt","ujhermes_sigma_opt"];

cases = ["szakov","szakov_sigma_opt","tomalom","tomalom_sigma_opt"];
idx = 1:4;

%blackBody, blackBodyExt, cividis, coolWarmBent, coolWarmSmooth, inferno, jet, kindlmann, kindlmannExt, magma, plasma, viridis
%discrete: lines, prism
% colorMapName = 'grayscale'; 
colorMapName = 'plasma';
colorMap = importdata(['../../Plot/ColorMaps/',colorMapName,'.col']);

fig = figure('Position',[200 200 1200 450]);
hold on; grid on;
% % moderately vulnerable
% plot([1e-3,1e-3],[1e-1,1e7],'--k','linewidth',1.5,'HandleVisibility','off')
% annotation('textarrow',[0.647,0.717],[0.71,0.71],'FontSize',13,'Linewidth',1.5)
% text(1e-2,3e6,'Moderately','FontSize',14,'HorizontalAlignment','center');
% text(1e-2,1.2e6,'vulnerable','FontSize',14,'HorizontalAlignment','center');
% % text(1e-2,3e6,'Mérsékelten','FontSize',14,'HorizontalAlignment','center');
% % text(1e-2,1.2e6,'sebezhetõ','FontSize',14,'HorizontalAlignment','center');
% % highly vulnerable
% plot([1e-2,1e-2],[1e-1,1e5],'--k','linewidth',1.5,'HandleVisibility','off')
% annotation('textarrow',[0.732,0.802],[0.53,0.53],'FontSize',13,'Linewidth',1.5)
% text(1e-1,3e4,'Highly','FontSize',14,'HorizontalAlignment','center');
% text(1e-1,1.2e4,'vulnerable','FontSize',14,'HorizontalAlignment','center');
% text(1e-1,3e4,'Kritikusan','FontSize',14,'HorizontalAlignment','center');
% text(1e-1,1.2e4,'sebezhetõ','FontSize',14,'HorizontalAlignment','center');
for I=idx
    data{1} = importdata(join(['Network Data/',cases(I),'/vulner_orig_rand.txt'],''));
%     data{1} = importdata(join(['Network Data/',cases(I),'/vulner_orig.txt'],''));
%     data{1} = importdata(join(['Network Data/',cases(I),'/vulner_N.txt'],''));
%     data{3} = importdata(join(['Network Data/',cases(I),'/vulner_Nm1.txt'],''));
    set(gca,'XScale','log','YScale','log');
    for i=1:size(data,2)
        gammaBar = data{i};
        gammaBarNZ = gammaBar(gammaBar~=0);
        n = length(gammaBarNZ);
        if(n>100)
            r = round(log(n)/log(2)+1);
        else
            r = round(sqrt(n));
        end
        b = prctile(gammaBarNZ,(0:1/r:1)*100);
        x = (b(1:end-1)+b(2:end))/2;
    %     x = b(1:end-1);

        f = zeros(r,1);
        % frequency
        for j=1:r
            f(j) = length(gammaBarNZ(gammaBarNZ>=b(j) & gammaBarNZ<b(j+1)));
        end
        f = f/sum(f); % relative frequency

        y = f./diff(b');

        if(I==1)
            subplot(1,2,1);
            hold on; grid on;
            xlim([1e-6,1e-1])
            ylim([1e0,1e5])
            xlabel('Local vulnerability [-]','fontsize',14);
            ylabel('Probability density [-]','fontsize',14);
            set(gca,'FontSize',14);
            c1 = 0.25;
            colr = min(1,max(0,interp1(colorMap(:,1),colorMap(:,2),c1,'spline')));
            colg = min(1,max(0,interp1(colorMap(:,1),colorMap(:,3),c1,'spline')));
            colb = min(1,max(0,interp1(colorMap(:,1),colorMap(:,4),c1,'spline')));
            marker = 'o';
        elseif(I==2)
            subplot(1,2,1);
            c1 = 0.75;
            colr = min(1,max(0,interp1(colorMap(:,1),colorMap(:,2),c1,'spline')));
            colg = min(1,max(0,interp1(colorMap(:,1),colorMap(:,3),c1,'spline')));
            colb = min(1,max(0,interp1(colorMap(:,1),colorMap(:,4),c1,'spline')));
            marker = 'x';
        elseif(I==3)
            subplot(1,2,2);
            hold on; grid on;
            xlim([1e-6,1e-1])
            ylim([1e0,1e5])
            xlabel('Local vulnerability [-]','fontsize',14);
            ylabel('Probability density [-]','fontsize',14);
            c1 = 0.25;
            colr = min(1,max(0,interp1(colorMap(:,1),colorMap(:,2),c1,'spline')));
            colg = min(1,max(0,interp1(colorMap(:,1),colorMap(:,3),c1,'spline')));
            colb = min(1,max(0,interp1(colorMap(:,1),colorMap(:,4),c1,'spline')));
            marker = 'o';
        elseif(I==4)
            subplot(1,2,2);
            c1 = 0.75;
            colr = min(1,max(0,interp1(colorMap(:,1),colorMap(:,2),c1,'spline')));
            colg = min(1,max(0,interp1(colorMap(:,1),colorMap(:,3),c1,'spline')));
            colb = min(1,max(0,interp1(colorMap(:,1),colorMap(:,4),c1,'spline')));
            marker = 'x';
        end
        plot([1e-3,1e-3],[1e-1,1e7],'--k','linewidth',1.0,'HandleVisibility','off')
        plot([1e-2,1e-2],[1e-1,1e5],'--k','linewidth',1.0,'HandleVisibility','off')
        t1 = text(2e-3,1e4,'Moderately','FontSize',14,'HorizontalAlignment','center');
        t2 = text(4e-3,1.1e4,'vulnerable','FontSize',14,'HorizontalAlignment','center');
        set(t1,'Rotation',90);
        set(t2,'Rotation',90);
        t1 = text(2e-2,1e3,'Highly','FontSize',14,'HorizontalAlignment','center');
        t2 = text(4e-2,1e3,'vulnerable','FontSize',14,'HorizontalAlignment','center');
        set(t1,'Rotation',90);
        set(t2,'Rotation',90);
        plot(x,y,marker,'color',[colr,colg,colb],'linewidth',2,'markersize',10);
    end
end

subplot(1,2,1);
legend('Original','Optimized','location','southwest');
title('Index of WDN: 11');
set(gca,'FontSize',14);
subplot(1,2,2);
legend('Original','Optimized','location','southwest');
title('Index of WDN: 10');
set(gca,'FontSize',14);

% xlabel('Local vulnerability [-]','fontsize',14);
% ylabel('Probability density [-]','fontsize',14);
% xlabel('Lokális sebezhetõség [-]','fontsize',14);
% ylabel('Valószínûségi sûrûség [-]','fontsize',14);
% legend(cases(idx));
% set(gca,'FontSize',14);
% xlim([1e-6,1e0])
% ylim([1e0,1e6])
% set(gca,'Position',[100,100,600,400])
% legend('Eredeti','N szabÃ¡ly','N-1 szabÃ¡ly');
% legend(cases);
% set(gca,'FontSize',14);
% ColumnLegend(3,num2str(idx(:)));
% ColumnLegend(3,num2str(idx(:)),'location','southwest_sf');
% legend('Original','N rule','N-1 rule');
% rectangle('Position',[1.3e-9 1.9e-1 7.5e-7 5e3],'FaceColor',[1 1 1])
% txt1 = text(3e-8,3e3,'Ivóvízhálózat','FontSize',14,'HorizontalAlignment','center');
% txt2 = text(3e-8,1.2e3,'sorszám','FontSize',14,'HorizontalAlignment','center');
% txt1 = text(2e-8,3e3,'Water distribution','FontSize',14,'HorizontalAlignment','center');
% txt2 = text(2e-8,1.2e3,'network','FontSize',14,'HorizontalAlignment','center');
% title('Failure rate: relative pipe length');
% title('Failure rate: pipe material');
% title('Hibaarány:                                                                                                                                                                            csõanyag');
% saveas(gca,'Plots/Vulner_orig_opt.fig','fig');
% saveas(gca,'Plots/Vulner_orig_opt.png','png');
% saveas(gca,'Plots/Vulner_orig_opt.eps','epsc');

