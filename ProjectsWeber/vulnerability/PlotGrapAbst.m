close all; 
clear;

addpath('../../Plot');

cases= ["villasor","ferto","sanchegy","buk","lovo","nagycenk","vashegy","varis","becsidomb","tomalom",...
    "szakov","kohegy","harka","pozsonyiut","sopronkovesd","dudlesz","ivan","agyagosszergeny","kofejto","simasag",...
    "acsad","csaford","nagylozs","balf","csapod","und","rojtokmuzsaj","brennberg","pusztacsalad","kutyahegy",...
    "nyarliget","meszlen","fertoujlak","gorbehalom","tozeggyarmajor","ebergoc","csillahegy","jerevan","gloriette",...
    "ohermes","ujhermes"];

idx = 1:27;

%blackBody, blackBodyExt, cividis, coolWarmBent, coolWarmSmooth, inferno, jet, kindlmann, kindlmannExt, magma, plasma, viridis
%discrete: lines, prism
% colorMapName = 'grayscale'; 
colorMapName = 'plasma';

colorMap = importdata(['../../Plot/ColorMaps/',colorMapName,'.col']);

% DEALING WITH ALFA*LENGTH STUFF
data = importdata('localGamma.txt');
data = data(idx,:);
figure('Position',[200 200 900 600]);
hold on; grid on;
set(gca,'XScale','log','YScale','log');
everyX=[];
everyY=[];
everyData=[];
gamma = zeros(length(idx),1);
for i=1:size(data,1)
    gammaBar{i} = str2num(data{i});
    everyData = [everyData, gammaBar{i}];
    gammaBarNZ{i} = gammaBar{i}(gammaBar{i}~=0);
    gamma(i) = sum(gammaBarNZ{i});
    n = length(gammaBarNZ{i});
    if(n>100)
        r = round(log(n)/log(2)+1);
    else
        r = round(sqrt(n));
    end
    b = prctile(gammaBarNZ{i},(0:1/r:1)*100);
    x = (b(1:end-1)+b(2:end))/2;
%     x = b(1:end-1);

    f = zeros(r,1);
    % frequency
    for j=1:r
        f(j) = length(gammaBarNZ{i}(gammaBarNZ{i}>=b(j) & gammaBarNZ{i}<b(j+1)));
    end
    f = f/sum(f); % relative frequency
    
    y = f./diff(b');
    
    colr = min(1,max(0,interp1(colorMap(:,1),colorMap(:,2),(i-1)/size(data,1),'spline')));
    colg = min(1,max(0,interp1(colorMap(:,1),colorMap(:,3),(i-1)/size(data,1),'spline')));
    colb = min(1,max(0,interp1(colorMap(:,1),colorMap(:,4),(i-1)/size(data,1),'spline')));
    
    if(mod(i,5) == 0)
        marker = 'x';
    elseif(mod(i,5) == 1)
        marker = 'o';
    elseif(mod(i,5) == 2)
        marker = '+';
    elseif(mod(i,5) == 3)
        marker = '*';
    elseif(mod(i,5) == 4)
        marker = 'p';
    end
    plot(x,y,marker,'color',[colr,colg,colb],'linewidth',1.5);

    % drawing columns
%     cx = reshape([b;b], [], 1)';
%     cx = cx(2:end-1);
%     cy = reshape([y';y'], [], 1)';
%     plot(cx,cy,'color',[colr,colg,colb],'linewidth',1.1);
end
xlabel('Local vulnerability','fontsize',14);
ylabel('Probability density','fontsize',14);
% xlabel('Szegmens sebezhetõség [-]','interpreter','latex','fontsize',14);
% ylabel('Valószínûség sûrûség [-]','interpreter','latex','fontsize',14);
xlim([1e-9,1e-1])
ylim([1e-1,1e8])
% set(gca,'Position',[100,100,600,400])
% legend(cases(idx),'location','west');
set(gca,'FontSize',14);
% ColumnLegend(3,num2str(idx(:)));
ColumnLegend(3,num2str(idx(:)),'location','southwest_sf');
rectangle('Position',[1.3e-9 1.9e-1 3.5e-7 5e3],'FaceColor',[1 1 1])

txt1 = text(2e-8,3e3,'Water Distribution','FontSize',14,'HorizontalAlignment','center');
txt2 = text(2e-8,1.2e3,'Networks','FontSize',14,'HorizontalAlignment','center');
% set(txt1,'Rotation',90);
% set(txt2,'Rotation',90);

% p1 = plot([1e-9,1e-1],[6e7,1e0],'--k','linewidth',3);
% uistack(p1,'bottom')


% m = 1e-4;
% s = 1e-4;
% xp = logspace(log10(1e-9),log10(1e-1),100);
% yp = normpdf(xp,m,s);
% plot(xp,yp,'x','Color',[0.7,0.7,0.7],'linewidth',3);

% saveas(gca,'Plots/GraphAbs.fig','fig');
% saveas(gca,'Plots/GraphAbs.png','png');
% saveas(gca,'Plots/GraphAbs.eps','epsc');

% BOX PLOT
figure(2156);cla;
set(gcf,'units','points','position',[100,100,600,200])
boxplot(gamma,'orientation','horizontal')
xlim([0,0.5])
a = gca;
a.Children.Children(1).MarkerEdgeColor = [0.87 0.4 0.38]; %outlier
a.Children.Children(1).LineWidth =1.5;
a.Children.Children(2).Color = [0.87 0.4 0.38]; %median
a.Children.Children(2).LineWidth =1.5;
a.Children.Children(3).Color = [0,0,0]; %box
a.Children.Children(3).LineWidth =1.5;
a.Children.Children(4).Color = [0.468 0.0 0.662]; %bottom
a.Children.Children(4).LineWidth =1.5;
a.Children.Children(5).Color = [0.468 0.0 0.662]; %top
a.Children.Children(5).LineWidth =1.5;
a.Children.Children(6).Color = [0.468 0.0 0.662]; %bottom
a.Children.Children(6).LineWidth =1.5;
a.Children.Children(7).Color = [0.468 0.0 0.662]; %top
a.Children.Children(7).LineWidth =1.5;

% a.Children.Children(1).MarkerEdgeColor = [0.2 0.2 0.2]; %outlier
% a.Children.Children(1).LineWidth =1.5;
% a.Children.Children(2).Color = [0.2 0.2 0.2]; %median
% a.Children.Children(2).LineWidth =1.5;
% a.Children.Children(3).Color = [0,0,0]; %box
% a.Children.Children(3).LineWidth =1.5;
% a.Children.Children(4).Color = [0.4 0.4 0.4]; %bottom
% a.Children.Children(4).LineWidth =1.5;
% a.Children.Children(5).Color = [0.4 0.4 0.4]; %top
% a.Children.Children(5).LineWidth =1.5;
% a.Children.Children(6).Color = [0.4 0.4 0.4]; %bottom
% a.Children.Children(6).LineWidth =1.5;
% a.Children.Children(7).Color = [0.4 0.4 0.4]; %top
% a.Children.Children(7).LineWidth =1.5;

set(gca,'ytick',[])
ylim([0.8,1.2])
xlabel('Network vulnerability')
% xlabel('Hálózati sebezhetõség [-]')
set(gca,'FontSize',14);
% saveas(gca,'Plots/GammaBoxPlot.fig','fig');
% saveas(gca,'Plots/GammaBoxPlot.png','png');
% saveas(gca,'Plots/GammaBoxPlot.eps','epsc');

